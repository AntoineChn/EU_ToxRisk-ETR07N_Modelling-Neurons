---
title: "More chemicals preliminary analysis"
output:
  html_document:
    toc: true
    toc_depth: 3
    code_folding: hide
    number_sections: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = '..')
knitr::opts_chunk$set(
  cache = FALSE,
  out.width = "100%",
  fig.align = 'center',
  fig.width = 8,
  fig.asp = 0.618,  # 1 / phi
  fig.show = "hold",
  warning=FALSE, message=FALSE,
  eval = TRUE, echo = TRUE
)
```

```{r copy_img_folder, include=F}
file.copy("./img", "./Rnotebook", recursive=TRUE, overwrite=T)
```


```{r glob_param, include=FALSE}
source("GlobalParameters.R")
source(glob_params$f.RFunc("stanFit_Name.R"))
pckToLoad = c('tidyverse', 'DT',"citr")
reloadpck()
```

# Introduction

Modelling qAOP using DBN

Model dis

# AOP ETR07N

```{r AOP_structure, echo=FALSE, out.width='100%'}
knitr::include_graphics('./img/AOP_ETR07N.png')
```

- Chemical : `Dose` for chemical concentration
- KE1 : `CIa` for complex I activity
- KE2 : `MTa` for Mitochondrial activity
- KE3 : `PRa` for proteostasis activity
- KE4 : `NRa` for Neurite Area

# Chemicals

```{r}
source(glob_params$f.RScript('load-and-reshape-morechemi.R'))
```

## What chemi has been tested

```{r}
reduce(list(KE1.other.chemi$chemi,
            KE2.other.chemi$chemi,
            KE3.other.chemi$chemi,
            KE4.other.chemi$chemi),
       union)
```

## Which chemi in each data set {.tabset .tabset-fade .tabset-pills}

### X -> CIa

```{r}
KE1.other.chemi$chemi %>% unique()
```

### X -> MTa
```{r}
KE2.other.chemi$chemi %>% unique()
```

### X -> PRa

```{r}
KE3.other.chemi$chemi %>% unique()
```

### X -> NRa

```{r}
KE4.other.chemi$chemi %>% unique()
```

## For which chemi we have all KEs

```{r}
cat("Common chemicals for all dataset are\n")

chemi.common = 
reduce(list(KE1.other.chemi$chemi,
            KE2.other.chemi$chemi,
            KE3.other.chemi$chemi,
            KE4.other.chemi$chemi),
       intersect)
chemi.common
```

# Visualisation {.tabset .tabset-fade .tabset-pills}

## X-> CIa
```{r}
# p.data = KE1.other.chemi
p.data = KE1.other.chemi %>% filter(chemi %in% chemi.common)
ggplot(data = p.data, 
       aes(x = concentration_MuMol, 
           y = c1_activity, colour = chemi)) + 
  geom_point() +
  geom_line(aes(group = chemi )) +
  scale_x_continuous(trans = "log10")
```

## X-> MTa
```{r}
# p.data = KE2.other.chemi
p.data = KE2.other.chemi %>% filter(chemi %in% chemi.common)
ggplot(data = p.data, 
       aes(x = concentration_MuMol, 
           y = mito_resp, colour = chemi)) + 
  geom_point() +
  geom_line(aes(group = chemi)) +
  scale_x_continuous(trans = "log10")
```

## X-> PRa
```{r}
# p.data = KE3.other.chemi
p.data = KE3.other.chemi %>% filter(chemi %in% chemi.common)
ggplot(data = p.data, 
       aes(x = concentration_MuMol, 
           y = Prot_acti, colour = chemi)) + 
  geom_point() +
  geom_line(aes(group = interaction(replication,chemi) )) +
  scale_x_continuous(trans = "log10")
```

## X-> NRa
```{r}
# p.data = KE4.other.chemi
p.data = KE4.other.chemi %>% filter(chemi %in% chemi.common)
ggplot(data = p.data, 
       aes(x = concentration_MuMol, 
           y = Neurite_Area, colour = chemi)) + 
  geom_point() +
  geom_line(aes(group = interaction(replication,chemi) )) +
  scale_x_continuous(trans = "log10")
```

# Remarks / questions

## Negative values
```{r}
KE1.other.chemi %>% 
  filter(chemi %in% chemi.common) %>%  
  filter(c1_activity <= 0)
KE2.other.chemi %>% 
  filter(chemi %in% chemi.common) %>%  
  filter(mito_resp <= 0)
KE3.other.chemi %>% 
  filter(chemi %in% chemi.common) %>%  
  filter(Prot_acti <= 0)
KE4.other.chemi %>% 
  filter(chemi %in% chemi.common) %>%  
  filter(Neurite_Area <= 0)
```

# workflow

1. fit upto KE1 CIa for common chemicals
2. predict CIa_pred for each chemicals
3. examine chemical independence hypothesis

